# DOM과 가상DOM(feat. React와 Svelte)

### DOM이란?
`DOM`이란 요컨대, `input`, `div` 태그 등의 HTML 요소들 하나하나가 아니라 HTML 주문서(작성된 코드)에 작성한 그 전체 구조에 맞춰서 제품들(요소)이 배치되고, 추가적인 명령을 보내서 속성이나 디자인, 배치 등을 조작할 수 있도록 된 상태, 즉 **`HTML이란 코드로 설계된 웹페이지가 브라우저 안에서 화면에 나타나고 이벤트에 반응하고 값을 입력받는 등 기능들을 수행할 객체들로 실체화된 형태`**이다.

이러한 `DOM`을 사용해서 원하는대로 웹 화면을 보여주고 필요에 따라 자바스크립트로 `DOM`을 조작할 수도 있다. 그렇다고 해서 `DOM`이 자바스크립트 요소인 것은 아니다. 자바스크립트를 사용하여 명령을 받을 수 있고, 실제로 그렇게 가장 흔히 사용되지만 `DOM`은 특정 언어에 종속되지는 않는다. **자바스크립트 객체는 아니지만 자바스크립트 등을 사용해서 제어할 수 있는 대상**인 것이다. (이를테면 파이썬의 `BeautifulSoup`로 `DOM`을 제어하곤 한다.) 어떤 언어로든 라이브러리만 갖춰지면 `DOM`을 조작할 수 있는데 이는 `DOM`이 API를 갖고 있기 때문이다.

### DOM의 구조와 속성
`DOM` 안에는 각종 `node`들이 `트리 구조`로 들어있다. `DOM`의 모든 요소들(`html`, `div`, `table`이든 뭐든)은 `node`로부터 상속받는다. 그러니까 모든 HTML의 요소들은 기본적으로 `node`다. 따라서 이들은 모두 `node`의 기능을 갖추고 있다. 

HTML 요소들에서 공통적으로 볼 수 있는 기능들은 대부분 `node`의 속성 또는 기능이다. 이를테면 `textContent`, `childNodes`, `firstChild`, `lastChild`, `parentNode`, `appendChild`, `insertBefore` 등등이 모두 `node`의 기능이다. 그리고 이 `node`는 `EventTarget`으로부터 상속받기 때문에, 즉 `node`는 클릭 등의 이벤트가 가해지는 `EventTarget`이기 때문에 이 요소들은 모두 `addEventListener` 등의 기능 또한 갖고 있는 것이다. 결국 이런 API들로 구성돼있기 때문에 MDN에서는 `DOM`을 '`**HTML이나 XML문서를 나타내는 API**`'라고 정의한다.

### CSSOM과 BOM
CSS는 `CSSOM`으로 따로 만들어진다. 이 또한 마찬가지로 포함 관계로 나타내져 트리 형식으로 출력된다. 브라우저는 `DOM 트리`와 `CSSOM 트리`를 융합해서 우리가 보는 화면을 만들어낸다. 

한편 Browser Object Model, `BOM`도 있다. 이는 브라우저 자체를 다루기 위한 API로 `alert`, `setTimeout` `window` 안의 `location`, `navigator`, `screen` 등(브라우저가 실행주체인 기능들)이 이에 해당한다.

### 가상 DOM이란?
그렇다면 `가상DOM`이란 무엇인가? `가상DOM`을 이해하기 위해선 `React`, `Vue` 등과 같은 SPA(Single Page Application, 페이지 전체를 재렌더링 하는 대신 바뀐 부분만 반영해서 렌더링하는 방식)에 대한 이해가 필요하다. SPA의 등장 이전에는 간결한 문법으로 `DOM`을 편리하게 다룰 수 있고, 어느 브라우저에서나 코드가 제대로 동작하도록 크로스 브라우징이 잘 돼있는 `jQuery`가 널리 쓰였다. 하지만 시대가 변화함에 따라 `jQuery`는 사실상 쇠퇴의 길을 걸었다. 일단 크로스 브라우징의 필요성이 전보단 줄어들었고, 순수 자바스크립트도 발전해서 충분히 간결하고 강력해졌다. `DOM`을 조작하는 방식도 `React`와 같은 것들이 생겨나며 불필요하게 무겁고, 옛날 자바스크립트 방식에 맞춰진 `jQuery`는 점점 밀려나게 되었다. `jQuery`는 직접 코드로 `DOM`을 조작하는 방식이었다. 이와 달리 `React`나 `Vue`는 템플릿으로 HTML 요소를 코딩해두고 그것들을 어떠한 변수 등에 들어간 데이터에 연결해놓는 식으로 그 데이터가 변경되면 그에 따라 화면을 재구성하는 방식이다. 이 과정에서 사용되는 게 `가상 DOM`이다. (`Angular`는 이와는 또 다르다.)

### 가상 DOM의 동작 방식과 사용하는 이유
`'가상' DOM`이라는 이름에서 알 수 있듯 진짜 `DOM`이 아니다. 그 구조만 간결히 흉내낸 자바스크립트 객체다. 뭐가 됐든 화면 구성을 바꾸려면 진짜 `DOM`에 조작이 가해져야만 할텐데 어째서 `가상 DOM`을 사용하는 것일까?

> HTML이란 주문서를 가지고 브라우저란 공장들이 그 설계를 실체로 만들어 낸 것이 `DOM`이라고 해보자. 화면을 구성한다는 것은 HTML 요소들을 가구와 같은 물리적인 실체로 찍어내어 주문서에 맞게 배치하는 상황이다. 이를테면 `div`는 딱딱한 상자, `table`은 선반 형태일 것이다. 이러한 모든 요소를 제작해서 HTML 주문서의 구조대로 각각 적합한 위치에 가져나 놓았다. 그런데 자바스크립트의 지시가 들어와 몇몇 요소를 빼거나 교체해야 한다고 해보자. 즉 `DOM`의 HTML 요소들에 조작이 가해지는 것이다. 그러면 전반적인 배치에도 변경 사항이 생긴다. 실제의 물리적인 상황이라고 생각한다면 참 머리 아픈 상황이다. 아마도 인부들이 그 근처를 모두 치우고 다시 하나하나 배치해나가야만 하니까. 이런 식으로 실제 `DOM`을 조작해나가는 것은 컴퓨터에 부담이 된다. 당연히 속도도 느리다. `가상DOM`을 쓴다는 건 이 가구들은 종이같은 거로 모양만 똑같이 나타낸 미니어처로 만든 후에 이 미니어처들을 움직여가며 어떤 가구들이 실제로 위치가 바뀌는지 먼저 파악을 한 뒤에 실제 가구들을 움직이는 것이다.

요컨대 실제 `DOM`은 무거우니까 그것들을 간략한 자바스크립트 오브젝트로 바꾼 다음에 이것들로 먼저 시뮬레이션을 해보고 가장 경제적으로 `DOM`에 변화를 가하는 방법을 찾아내는 식이다. 기존의 배치 모습과 바뀐 모습을 합리적인 알고리즘으로 비교해서 차이가 생기는 부분만 파악한다. (이를 `**diffing**`이라 한다.) 그리고 그 부분만 실제 `DOM`에 반영한다. 

이러한 이유로 `React`, `Vue` 등은 보다 빠르고 가볍게 화면들을 조작할 수 있다고 '알려져 있다'. 정확히는 `가상 DOM` 때문에 빠르다는 것은 옳지 않다. 당장 최근 급부상하고 있는 `Svelte`의 경우 `가상 DOM`을 쓰지 않기 때문에 빠르다고 알려져 있다. 앞서 미니어처 시뮬레이션으로 예시를 들었는데, 그러한 시뮬레이션 과정을 빼면 더 빨라질 것이다. 그러한 과정없이도 효율적으로 `DOM`을 조작할 수 있다면 말이다. `가상 DOM`을 쓴다는 것도 결국 어떤 과정을 추가한 것이다. 만약 그런 과정을 추가하지 않고도 효율적으로 `DOM`을 조작할 수 있다면 `React`나 `Vue`는 왜 `가상 DOM`을 이용하는가?

### 이들과는 다른 Svelte
`React`나 `Vue`는 라이브러리 혹은 프레임워크고 `Svelte`는 컴파일러라는 데 차이가 있다. `React`로 만든 사이트들은 `React`의 기능들을 담은 자바스크립트 파일들을 사용해서 동작한다. `가상 DOM`은 이 과정에서 브라우저 단의 작업을 효율적으로 해내기 위해 만들어졌다고 보는 게 더 맞다. 사용자가 작성한 `React` 전용 코드를 브라우저가 `가상 DOM`으로 해석해서 메모리에서 먼저 구현한 다음 최종적으로 실제 `DOM`에 적용한다. `DOM` 변경을 웹사이트에 로드된 `React`나 `Vue` 라이브러리가 가장 빠르게는 아니지만 사용자가 불편하지 않을 만큼 충분히 빠르게 설계한 결과물이 `가상 DOM`방식인 것이다. `Svelte`는 뭐가 다를까?

위의 `React` 등이 거치는 과정은 사이트가 실행되는 시점, 즉 런타임에서 일어나는 일이다. 브라우저가 자바스크립트 파일을 받아서 하는 작업이라는 것이다. `가상 DOM`은 이 런타임이란 제약 조건 하에서 브라우저에 로드된 라이브러리로서 `DOM`에 가해지는 변화들을 최소한의 변경으로 구현할 방법을 찾는 방식이다. 반면 `Svelte`는 그 과정을 사이트가 배포되기 전에 미리 다 해두도록 한 것이다. (그래서 컴파일. 어떤 데이터가 바뀌면 어떤 가구만 움직이면 될지 미리 전부 계산해놓고 그 다음에 그걸 빌드해서 내놓는 식.) `Svelte`로 만든 사이트의 소스를 보면 JS 파일 안에 `Svelte` 관련 코드가 없음을 확인할 수 있다. `Svelte` 형식에 맞추어 코딩을 하면 `Svelte`는 사이트에서 실제로 일어날 일들만 컴팩트한 자바스크립트 파일로 컴파일해서 내놓는다. 따라서 브라우저에서 따로 무언가 돌릴 필요가 없어진다. 이러한 이유로 `Svelte`로 만들어진 사이트는 용량도 더 가볍고 `DOM`조작도 더 빠르다. 

그러면 `Svelte`가 최고인 것일까? 이제부터는 `React`보다 `Svelte`를 배우는 게 나을까? 이에 대해선 아직 무어라 확언하기 힘들다. `Svelte`가 상대적으로 덜 오래됐기 때문에 기능이나 커뮤니티가 덜 쌓인 점, 코드를 미리 컴파일해서 내보내야 한다는 게 특정 형태의 사이트에서는 한계가 될 수 있다는 점 등이 단점으로 작용할 수 있다. 이에 비해 `React`나 `Vue`는 강력한 기능들도 많고 안전성도 많이 다져진 상태다. 따라서 앞선 이야기들을 기억하고 추이를 지켜보며 각자의 필요에 적합한 걸 선택하는 것이 바람직하겠다.


출처 및 참고: [DOM은 뭐고 가상 DOM은 뭔가요? (+ Svelte와 React의 차이)](https://www.youtube.com/watch?v=1ojA5mLWts8)

